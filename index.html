<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Dashboard with Multi-Select</title>
<style>
:root{
  --radius:18px;
  --shadow:0 15px 40px rgba(0,0,0,.55);
}

*{box-sizing:border-box;}

body{
  margin:0;
  font-family:system-ui;
  background:#000;
  color:white;
  min-height:100vh;
}

.wrap{
  max-width:1200px;
  margin:auto;
  padding:40px 20px;
}

.grid{
  display:grid;
  gap:32px;
  grid-template-columns:repeat(auto-fill,minmax(300px,1fr));
}

.card-item{
  position:relative;
  padding:18px;
  border-radius:var(--radius);
  background:rgba(0,0,0,.55);
  border:1px solid rgba(255,255,255,.15);
  cursor:pointer;
  transition:.25s;
  user-select:none;
}

.card-item.full{
  grid-column: span 2;
}

.card-item.half{
  grid-column: span 1;
}

.card-item:hover{transform:translateY(-3px);}
.card-item.selected{outline:2px solid white; box-shadow:0 0 10px white;}

.selection-circle{
  position:absolute;
  top:10px;
  left:10px;
  width:20px;
  height:20px;
  border:2px solid white;
  border-radius:50%;
  display:none;
  cursor:pointer;
}
.selection-circle.selected{
  background:white;
}

.name{font-weight:800;font-size:16px;}
.meta{font-size:12px;opacity:.7;}

.modal,.editor{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.75);
  display:flex;
  justify-content:center;
  align-items:center;
  opacity:0;
  pointer-events:none;
  transition:.25s;
}

.modal.active,.editor.active{
  opacity:1;
  pointer-events:auto;
}

.modal-box,.editor-box{
  background:#111;
  padding:28px;
  border-radius:16px;
  width:420px;
  max-width:95%;
  max-height:80vh;
  display:flex;
  flex-direction:column;
  gap:14px;
  overflow-y:auto;
}

input,select{
  padding:8px;
  background:#222;
  border:1px solid #444;
  color:white;
  border-radius:6px;
}

button{
  padding:10px;
  border:none;
  cursor:pointer;
  border-radius:6px;
}

#addCardBtn{
  margin-top:32px;
  background:white;
  color:black;
  font-weight:600;
}
</style>
</head>
<body>

<div class="wrap">
<div class="grid" id="dashboard">

<div class="card-item full" data-detail="Full card popup.">
<p class="name">Full Card One</p>
<p class="meta">Detailed info</p>
</div>

<div class="card-item half" data-detail="Half A popup">
<p class="name">Half Card A</p>
<p class="meta">Snippet</p>
</div>

<div class="card-item half" data-detail="Half B popup">
<p class="name">Half Card B</p>
<p class="meta">Snippet</p>
</div>

</div>
<button id="addCardBtn">+ Add Card</button>
</div>

<!-- View Modal -->
<div class="modal" id="viewModal">
<div class="modal-box">
<p id="modalText"></p>
<button onclick="closeView()">Close</button>
</div>
</div>

<!-- Editor -->
<div class="editor" id="editor">
<div class="editor-box">

<label>Text</label>
<input type="text" id="editText">

<label>Text Color</label>
<input type="color" id="editTextColor">

<label>Text Size</label>
<input type="number" id="editTextSize" min="10" max="72">

<label>Box Color</label>
<input type="color" id="editBoxColor">

<label>Gradient</label>
<select id="gradientSelect">
<option value="none">None</option>
<option value="linear">Linear</option>
</select>

<label>Upload Background Image</label>
<input type="file" id="editBgFile" accept="image/*">

<button id="removeImage">Remove Background Image</button>

<label>Blur</label>
<input type="range" id="editBlur" min="0" max="30">

<label>Card Type</label>
<select id="cardType">
<option value="full">Full Card</option>
<option value="half">Half Card</option>
</select>

<button id="saveEdit">Save Changes</button>
</div>
</div>

<script>
let currentElement = null;
let dragged = null;
let selectionMode = false;
let selectedCards = new Set();

const dashboard = document.getElementById("dashboard");
const viewModal = document.getElementById("viewModal");
const modalText = document.getElementById("modalText");
const editor = document.getElementById("editor");

/* ------------------------
   DRAG SYSTEM
------------------------ */
function enableDrag(el){
  el.setAttribute("draggable", true);
  el.addEventListener("dragstart",()=>dragged=el);
  el.addEventListener("dragover",e=>e.preventDefault());
  el.addEventListener("drop",e=>{
    e.preventDefault();
    const target = e.target.closest(".card-item");
    if(target && dragged!==target){
      const children = Array.from(dashboard.children);
      const draggedIndex = children.indexOf(dragged);
      const targetIndex = children.indexOf(target);
      if(draggedIndex<targetIndex){
        dashboard.insertBefore(dragged, target.nextSibling);
      } else {
        dashboard.insertBefore(dragged, target);
      }
    }
  });
}

/* ------------------------
   ADD SELECTION CIRCLE
------------------------ */
function addSelectionCircle(el){
  const circle = document.createElement("div");
  circle.className="selection-circle";
  el.appendChild(circle);
  el.selectionCircle = circle;

  circle.addEventListener("click", e=>{
    e.stopPropagation();
    toggleCardSelection(el);
  });
}

/* ------------------------
   TOGGLE CARD SELECTION
------------------------ */
function toggleCardSelection(el){
  if(selectedCards.has(el)){
    selectedCards.delete(el);
    el.classList.remove("selected");
    el.selectionCircle.classList.remove("selected");
  } else {
    selectedCards.add(el);
    el.classList.add("selected");
    el.selectionCircle.classList.add("selected");
  }
}

/* ------------------------
   ADD EDIT BUTTON
------------------------ */
function addEditButton(el){
  el.addEventListener("dblclick", e=>{
    if(!selectionMode){
      currentElement = el;
      openEditor([el]);
    }
  });
}

/* ------------------------
   INITIAL CARDS SETUP
------------------------ */
function initCard(el){
  enableDrag(el);
  addEditButton(el);
  addSelectionCircle(el);

  let holdTimeout = null;
  el.addEventListener("mousedown",()=>{
    holdTimeout = setTimeout(()=>{
      selectionMode = true;
      document.querySelectorAll(".selection-circle").forEach(c=>c.style.display="block");
      toggleCardSelection(el);
    }, 400);
  });
  el.addEventListener("mouseup",()=>{
    clearTimeout(holdTimeout);
  });
  el.addEventListener("mouseleave",()=>{
    clearTimeout(holdTimeout);
  });
  el.addEventListener("click",()=>{
    if(selectionMode){
      toggleCardSelection(el);
    } else {
      modalText.textContent = el.dataset.detail;
      viewModal.classList.add("active");
    }
  });
}

Array.from(dashboard.children).forEach(initCard);

/* ------------------------
   ADD NEW CARD
------------------------ */
document.getElementById("addCardBtn").addEventListener("click",()=>{
  const type=prompt("Enter card type: 'full' or 'half'").toLowerCase();
  const newCard=document.createElement("div");
  newCard.className="card-item";
  if(type==="half") newCard.classList.add("half");
  else newCard.classList.add("full");
  newCard.innerHTML=`<p class="name">New Card</p><p class="meta">New Info</p>`;
  dashboard.appendChild(newCard);
  initCard(newCard);
});

/* ------------------------
   OPEN EDITOR FOR MULTIPLE
------------------------ */
function openEditor(cards){
  currentElement = cards[0]; // main reference
  // fill in first card's data
  const nameEl = currentElement.querySelector(".name");
  if(nameEl){
    editText.value = nameEl.textContent;
    editTextSize.value = parseInt(getComputedStyle(nameEl).fontSize);
    editTextColor.value = rgbToHex(getComputedStyle(nameEl).color);
  }
  cardType.value = currentElement.classList.contains("half")?"half":"full";
  editor.classList.add("active");
}

/* ------------------------
   SAVE EDITS
------------------------ */
document.getElementById("saveEdit").addEventListener("click",()=>{
  if(selectedCards.size===0 && !currentElement) return;

  const cardsToEdit = selectedCards.size>0 ? Array.from(selectedCards) : [currentElement];

  cardsToEdit.forEach(el=>{
    const nameEl = el.querySelector(".name");
    if(nameEl){
      nameEl.textContent = editText.value;
      nameEl.style.color = editTextColor.value;
      nameEl.style.fontSize = editTextSize.value+"px";
    }

    const type = cardType.value;
    el.classList.remove("half","full");
    el.classList.add(type);

    const color=editBoxColor.value;
    const gradient=gradientSelect.value;

    if(gradient==="linear"){
      el.style.backgroundImage=`linear-gradient(135deg,${color},black)`;
    } else {
      el.style.backgroundColor=color;
      el.style.backgroundImage="";
    }

    if(editBgFile.files[0]){
      const reader=new FileReader();
      reader.onload=e=>{
        el.style.backgroundImage=`url(${e.target.result})`;
        el.style.backgroundSize="cover";
        el.style.backgroundPosition="center";
      };
      reader.readAsDataURL(editBgFile.files[0]);
      editBgFile.value="";
    }

    el.style.backdropFilter=`blur(${editBlur.value}px)`;
  });

  editor.classList.remove("active");
  selectedCards.forEach(c=>{ c.classList.remove("selected"); c.selectionCircle.style.display="none"; });
  selectedCards.clear();
  selectionMode=false;
});

/* ------------------------
   REMOVE IMAGE
------------------------ */
document.getElementById("removeImage").addEventListener("click",()=>{
  const cardsToEdit = selectedCards.size>0 ? Array.from(selectedCards) : [currentElement];
  cardsToEdit.forEach(el=>{
    el.style.backgroundImage="";
  });
});

/* ------------------------
   CLOSE EDITOR
------------------------ */
editor.addEventListener("click", e=>{
  if(e.target===editor) editor.classList.remove("active");
});

/* ------------------------
   COLOR HELPER
------------------------ */
function rgbToHex(rgb){
  const result=rgb.match(/\d+/g);
  return "#"+result.map(x=>{
    const hex=parseInt(x).toString(16);
    return hex.length==1?"0"+hex:hex;
  }).join('');
}

/* ------------------------
   CLOSE VIEW
------------------------ */
function closeView(){viewModal.classList.remove("active");}
</script>
</body>
</html>

